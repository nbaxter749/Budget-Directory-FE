<div class="container" style="margin-top: 70px">
  <div class="row" *ngIf="budget">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <h2>{{ budget.username }}'s Budget</h2>
        </div>
        <div class="card-body">
          <h5 class="card-title">Budget Details</h5>
          <p class="card-text">
            <strong>Town:</strong> {{ budget.town }}<br>
            <strong>Monthly Income:</strong> £{{ budget.monthly_income }}<br>
            <strong>Current Savings:</strong> £{{ budget.savings?.current || 0 }}<br>
            <strong>Savings Goal:</strong> £{{ budget.savings?.goal || 0 }}<br>
            <strong>Progress:</strong> {{ budget.savings?.progress || 0 }}%
          </p>
        </div>
      </div>

      <!-- Reviews Section -->
      <div class="card mt-4">
        <div class="card-header">
          <h4>Reviews</h4>
        </div>
        <div class="card-body">
          <div *ngFor="let review of reviews" class="border-bottom pb-2 mb-2">
            <strong>{{ review.username }}</strong>
            <span class="text-warning">★</span> {{ review.stars }}/5
            <p class="mt-1">{{ review.comment }}</p>
          </div>

          <!-- Add Review Form - Only show when authenticated -->
          <div *ngIf="auth.isAuthenticated$ | async">
            <form (ngSubmit)="submitReview()" class="mt-3">
              <div class="mb-3">
                <label for="username" class="form-label">Username:</label>
                <input type="text" class="form-control" id="username" 
                       [(ngModel)]="newReview.username" name="username" required>
              </div>
              <div class="mb-3">
                <label for="comment" class="form-label">Comment:</label>
                <textarea class="form-control" id="comment" rows="3"
                          [(ngModel)]="newReview.comment" name="comment" required></textarea>
              </div>
              <div class="mb-3">
                <label for="stars" class="form-label">Stars (1-5):</label>
                <input type="number" class="form-control" id="stars" min="1" max="5"
                       [(ngModel)]="newReview.stars" name="stars" required>
              </div>
              <button type="submit" class="btn btn-primary">Add Review</button>
            </form>
          </div>
          
          <!-- Show message when not authenticated -->
          <div *ngIf="!(auth.isAuthenticated$ | async)" class="mt-3">
            <p class="text-muted">Please log in to add a review.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Google Map Section -->
    <div class="col-md-4">
      <div class="card">
        <div class="card-header">
          <h4>Location</h4>
        </div>
        <div class="card-body">
          <google-map 
            [center]="center" 
            [zoom]="zoom"
            width="100%" 
            height="300px">
            <map-marker 
              *ngIf="markerPosition"
              [position]="markerPosition"
              [title]="budget.town">
            </map-marker>
          </google-map>
        </div>
      </div>
    </div>
  </div>
</div>
